<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEAcademy | Super Trainer Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #e60000; --dark: #1a1a1a; --gray: #f4f4f4; }
        body { font-family: 'Poppins', sans-serif; background: var(--gray); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        
        .upload-section { 
            background: #fdfdfd; padding: 25px; border-radius: 15px; border: 1px solid #eee; margin-bottom: 30px;
        }

        .upload-area { border: 2px dashed #bbb; padding: 30px; text-align: center; border-radius: 15px; cursor: pointer; display: block; margin-bottom: 15px; }
        .upload-area:hover { border-color: var(--primary); background: #fff5f5; }

        input[type="text"], select { padding: 12px; border: 1px solid #ccc; border-radius: 8px; width: 100%; margin-bottom: 10px; font-family: inherit; }
        
        .btn { padding: 15px; border: none; border-radius: 10px; cursor: pointer; font-weight: 800; width: 100%; text-transform: uppercase; }
        .btn-add { background: var(--primary); color: white; }

        /* SÄ°LMÆ HÄ°SSÆSÄ° ÃœÃ‡ÃœN STÄ°L */
        .management-section { margin-top: 40px; border-top: 3px solid var(--primary); padding-top: 20px; }
        .manage-card { 
            display: flex; justify-content: space-between; align-items: center; 
            background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #eee; 
            margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .btn-delete { background: #ff4d4d; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: 700; }
        .btn-delete:hover { background: #cc0000; }
        
        .course-tag { background: #333; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin-right: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h1 style="color:var(--primary); text-align:center;">Trainer Ä°darÉ™etmÉ™ Paneli</h1>

        <div class="upload-section">
            <h3 style="margin-top:0;">1. Yeni Material YÃ¼klÉ™</h3>
            <label for="universalPicker" class="upload-area">
                <span id="fileNameDisplay" style="font-weight:700;">ğŸ“‚ FAYLI SEÃ‡Ä°N</span>
                <input type="file" id="universalPicker" style="display:none;" onchange="handleFileSelect(this)">
            </label>
            
            <input type="text" id="mTitle" placeholder="MaterialÄ±n BaÅŸlÄ±ÄŸÄ± (MÉ™sÉ™lÉ™n: Kompyuterin ÆsaslarÄ±)">
            <select id="targetCourse">
                <option value="IT">ğŸ’» IT BÃ¶lmÉ™si</option>
                <option value="KEA">â˜• KEA BÃ¶lmÉ™si</option>
                <option value="BEYAZ">â„ï¸ BEYAZ BÃ¶lmÉ™si</option>
                <option value="TV">ğŸ“º TV BÃ¶lmÉ™si</option>
            </select>
            <button class="btn btn-add" id="uploadBtn" onclick="pushToDatabase()">SÄ°STEMÆ KÃ–Ã‡ÃœR</button>
        </div>

        <div class="management-section">
            <h3>2. MÃ¶vcud MateriallarÄ± Ä°darÉ™ Et (SÄ°L)</h3>
            <p style="font-size: 13px; color: #666;">Portalda hal-hazÄ±rda aktiv olan dÉ™rslÉ™r:</p>
            <div id="materialsList">
                <p>YÃ¼klÉ™nir...</p>
            </div>
        </div>
    </div>

    <script>
        const FIREBASE_DB = "https://beacademy-c8316-default-rtdb.firebaseio.com/portal_content";
        let hiddenData = ""; 

        // SÉ™hifÉ™ aÃ§Ä±lan kimi siyahÄ±nÄ± gÃ¶stÉ™r
        window.onload = fetchMaterials;

        function handleFileSelect(input) {
            const file = input.files[0];
            if (!file) return;
            document.getElementById('fileNameDisplay').innerText = "âœ… SEÃ‡Ä°LDÄ°: " + file.name;
            const reader = new FileReader();
            reader.onload = e => hiddenData = e.target.result;
            reader.readAsText(file);
        }

        // BAZADAN MATERÄ°ALLARI Ã‡ÆKÄ°B SÄ°HAHIYA DÃœZÃœR
        async function fetchMaterials() {
            const listDiv = document.getElementById('materialsList');
            try {
                const response = await fetch(`${FIREBASE_DB}.json`);
                const data = await response.json();
                listDiv.innerHTML = "";
                
                if (data) {
                    for (let course in data) {
                        if (data[course]) {
                            const card = `
                                <div class="manage-card">
                                    <div>
                                        <span class="course-tag">${course}</span>
                                        <strong>Material yÃ¼klÉ™nib</strong>
                                    </div>
                                    <button class="btn-delete" onclick="deleteMaterial('${course}')">SÄ°STEMDÆN SÄ°L</button>
                                </div>`;
                            listDiv.innerHTML += card;
                        }
                    }
                } else {
                    listDiv.innerHTML = "<p>HeÃ§ bir material tapÄ±lmadÄ±.</p>";
                }
            } catch (err) { listDiv.innerHTML = "<p>XÉ™ta: SiyahÄ± gÉ™tirilÉ™ bilmÉ™di.</p>"; }
        }

        // SÄ°LMÆ FUNKSÄ°YASI
        async function deleteMaterial(course) {
            if (!confirm(course + " bÃ¶lmÉ™sini tamamilÉ™ silmÉ™k istÉ™yirsiniz?")) return;
            
            try {
                await fetch(`${FIREBASE_DB}/${course}.json`, { method: 'DELETE' });
                alert("Silindi!");
                fetchMaterials(); // SiyahÄ±nÄ± tÉ™zÉ™lÉ™
            } catch (err) { alert("SilinmÉ™di!"); }
        }

        // YÃœKLÆMÆ FUNKSÄ°YASI
        async function pushToDatabase() {
            const title = document.getElementById('mTitle').value.trim();
            const folder = document.getElementById('targetCourse').value;
            const btn = document.getElementById('uploadBtn');

            if (!hiddenData || !title) return alert("Fayl vÉ™ ya BaÅŸlÄ±q É™skikdir!");

            btn.innerText = "YÃœKLÆNÄ°R...";
            btn.disabled = true;

            const combinedContent = `<h2>${title}</h2><hr>${hiddenData}`;

            try {
                await fetch(`${FIREBASE_DB}/${folder}.json`, {
                    method: 'PUT',
                    body: JSON.stringify(combinedContent)
                });
                alert("UÄŸurla yÃ¼klÉ™ndi!");
                document.getElementById('mTitle').value = "";
                hiddenData = "";
                document.getElementById('fileNameDisplay').innerText = "ğŸ“‚ FAYLI SEÃ‡Ä°N";
                fetchMaterials(); // SiyahÄ±nÄ± tÉ™zÉ™lÉ™
            } catch (err) { alert("XÉ™ta!"); }
            finally { btn.innerText = "SÄ°STEMÆ KÃ–Ã‡ÃœR"; btn.disabled = false; }
        }
    </script>
</body>
</html>
